package com.pgl.services;import com.pgl.models.FinancialInstitution;import com.pgl.models.FinancialProductHolder;import com.pgl.models.User;import com.pgl.repositories.FinancialProductHolderRepository;import org.apache.commons.lang3.SerializationUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;import org.springframework.stereotype.Service;import java.util.Date;@Service()public class FinancialProductHolderService {    @Autowired    FinancialProductHolderRepository financialProductHolderRepository;    @Autowired    BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();    public FinancialProductHolderRepository getRepository(){        return financialProductHolderRepository;    }    /**     * Create a new Financial Product Holder or update     * @param financialProductHolder     * @return     */    public FinancialProductHolder saveHolder(FinancialProductHolder financialProductHolder){        FinancialProductHolder result = getRepository().findHolderByInstitutionAndClient(financialProductHolder.getFinancialInstitution().getBIC(),                financialProductHolder.getNationalRegister());        //      if it is a new financial product holder and already exists for this Financial Institution        if(!financialProductHolder.toUpdate && result != null){            throw new RuntimeException("This element already exists");        }//        FinancialProductHolder holder;        //      if it's a new holder and doesn't exist yet        if (result == null) {            financialProductHolder.setCreationDate(new Date());//            holder = SerializationUtils.clone(financialProductHolder);        }else { // if the holder already exists and update it            result.setModificationDate(new Date());            result.setName(financialProductHolder.getName());            result.setFirstName(financialProductHolder.getFirstName());            result.setNationalRegister(result.getNationalRegister());            result.setBirthDate(result.getBirthDate());            financialProductHolder = result;//            financialProductHolder.setFinancialInstitution(result.getFinancialInstitution());//            holder = SerializationUtils.clone(financialProductHolder);        }        return getRepository().save(financialProductHolder);    }    /**     * Check if the password provided by the financial product holder is correct     * @param user     * @return     */    public boolean checkPassword(User user, String password){        return bCryptPasswordEncoder.matches(password, user.getPassword());    }    /**     * Crypt a password     * @param password     * @return     */    public String cryptPassword(String password){        return bCryptPasswordEncoder.encode(password);    }}